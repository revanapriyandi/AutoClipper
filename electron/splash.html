<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>AutoClipper</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        background: #09090b;
        color: #e4e4e7;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        overflow: hidden;
        -webkit-app-region: drag;
        user-select: none;
      }

      /* Logo icon */
      .logo-icon {
        width: 64px;
        height: 64px;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        box-shadow: 0 0 40px rgba(99, 102, 241, 0.25);
      }
      .logo-icon svg {
        width: 32px;
        height: 32px;
        color: white;
      }

      .app-name {
        font-size: 1.5rem;
        font-weight: 700;
        letter-spacing: -0.03em;
        color: #f4f4f5;
        margin-bottom: 4px;
      }
      .app-sub {
        font-size: 0.7rem;
        font-weight: 500;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        color: #52525b;
        margin-bottom: 32px;
      }

      /* Progress bar */
      .progress-track {
        width: 220px;
        height: 2px;
        background: #27272a;
        border-radius: 2px;
        overflow: hidden;
        margin-bottom: 14px;
      }
      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #6366f1, #8b5cf6);
        border-radius: 2px;
        width: 15%;
        transition: width 0.4s ease;
        animation: indeterminate 1.8s ease-in-out infinite;
      }
      @keyframes indeterminate {
        0% {
          transform: translateX(-100%);
          width: 40%;
        }
        100% {
          transform: translateX(300%);
          width: 40%;
        }
      }
      .progress-bar.determinate {
        animation: none;
        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Status text */
      .status {
        font-size: 0.72rem;
        color: #71717a;
        text-align: center;
        height: 18px;
        transition: opacity 0.2s ease;
        font-weight: 400;
        letter-spacing: 0.01em;
      }
      .status.update {
        color: #a1a1aa;
      }

      /* Step dots */
      .dots {
        display: flex;
        gap: 5px;
        margin-top: 20px;
      }
      .dot {
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: #3f3f46;
        transition: background 0.3s;
      }
      .dot.done {
        background: #6366f1;
      }
      .dot.active {
        background: #818cf8;
      }
    </style>
  </head>
  <body>
    <div class="logo-icon">
      <svg
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="6" cy="6" r="3" />
        <circle cx="6" cy="18" r="3" />
        <line x1="20" y1="4" x2="8.12" y2="15.88" />
        <line x1="14.47" y1="14.48" x2="20" y2="20" />
        <line x1="8.12" y1="8.12" x2="12" y2="12" />
      </svg>
    </div>

    <div class="app-name">AutoClipper</div>
    <div class="app-sub">AI Video Clipper</div>

    <div class="progress-track">
      <div class="progress-bar" id="bar"></div>
    </div>

    <div class="status" id="status">Memulai aplikasi...</div>

    <div class="dots">
      <div class="dot active" id="d0"></div>
      <div class="dot" id="d1"></div>
      <div class="dot" id="d2"></div>
      <div class="dot" id="d3"></div>
      <div class="dot" id="d4"></div>
    </div>

    <script>
      const statusEl = document.getElementById("status");
      const bar = document.getElementById("bar");
      let currentStep = 0;

      // Map of status message patterns â†’ step index + progress %
      const STEPS = [
        {
          pattern: /memulai|starting|init/i,
          step: 0,
          pct: 10,
          label: "Memulai proses...",
        },
        {
          pattern: /database|prisma|sqlite/i,
          step: 1,
          pct: 30,
          label: "Menyiapkan database...",
        },
        {
          pattern: /schema|tabel|tables|push/i,
          step: 2,
          pct: 50,
          label: "Mengerjakan skema database...",
        },
        {
          pattern: /handler|ipc|register/i,
          step: 3,
          pct: 75,
          label: "Memuat komponen...",
        },
        {
          pattern: /siap|ready|selesai|done|loaded/i,
          step: 4,
          pct: 95,
          label: "Hampir selesai...",
        },
      ];

      function setStatus(msg) {
        statusEl.textContent = msg;
        statusEl.className = "status update";
        // Match to step
        for (const s of STEPS) {
          if (s.pattern.test(msg)) {
            advanceTo(s.step, s.pct);
            if (statusEl.textContent === msg) statusEl.textContent = msg; // keep original
            break;
          }
        }
        // Revert color after brief flash
        setTimeout(() => (statusEl.className = "status"), 500);
      }

      function advanceTo(step, pct) {
        if (step <= currentStep) return;
        currentStep = step;
        // Update dots
        for (let i = 0; i <= 4; i++) {
          const d = document.getElementById("d" + i);
          if (i < step) d.className = "dot done";
          else if (i === step) d.className = "dot active";
          else d.className = "dot";
        }
        // Update bar
        bar.className = "progress-bar determinate";
        bar.style.width = pct + "%";
      }

      // Listen for IPC status messages from main process
      if (window.splashAPI) {
        window.splashAPI.onStatus((msg) => setStatus(msg));
      }

      // Fallback cycling messages if no IPC
      const fallback = [
        "Menyiapkan database...",
        "Memuat komponen...",
        "Hampir selesai...",
      ];
      let fi = 0;
      const timer = setInterval(() => {
        if (currentStep > 0) {
          clearInterval(timer);
          return;
        }
        fi = (fi + 1) % fallback.length;
        statusEl.textContent = fallback[fi];
      }, 2500);
    </script>
  </body>
</html>
